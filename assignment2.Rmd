# Assignment 2
## Biomedical Data Science
## B159640

This Rmarkdown document provides answers, tables and graphs for the problems 1-4 and the R code used to obtain them. It is recommended to knit the Rmarkdown to HTML to obtain the intended formatting.

### Problem 1

Loading datasets `lipids.txt` and `lipid-classes.txt` required for problem 1
```{r}
# load library to work with data tables (also for all following problems)
library(data.table)

# import file and look up files
lipids.dt <- fread("lipids.txt", stringsAsFactors = TRUE)
lipid.classes.dt <- fread("lipid-classes.txt", stringsAsFactors = TRUE)
```

#### Problem 1 (a)

Using the lipid-class lookup table `lipid.classes.dt` to determine the lipid classes
of the lipid species listed `lipids.dt`, then adding a new lipid class colum to `lipids.dt`: 

Writing a function to classify the lipids in a given data table.
It accepts as input a data table `lipid.table`, a string `lipid.species.col` that specifies the column of `lipid.table` in which the lipid species are stored and a vector `lipid.classes`:
```{r}
classify.lipids <- function(lipid.table, lipid.species.col, lipid.classes){
  
  # add  class colum to lipid.table
  lipid.table[, lipid.class := NA]
  
  # loop over over all lipid classes
  
  for(lipid in lipid.classes){
    
    # create regex that finds all lipid class identifiers
    regex <- paste0("(\\s|^)[", 
                    toupper(substr(lipid,1,1)),
                    tolower(substr(lipid,1,1)),
                    "](",
                    toupper(substr(lipid,2,nchar(lipid))),
                    "|",
                    tolower(substr(lipid,2,nchar(lipid))),
                    ")(\\s|$)")
  
    # add new col lipid.class to lipid.dt
    
    lipid.species <- paste0(lipid.table, "$" , lipid.species.col)
    lipid.table[, lipid.class := ifelse(grepl(regex, lipid.species), lipid, lipid.class)]
  }
}
```

Classifying the lipids:
```{r}
classify.lipids(lipids.dt, "lipid.species" , lipid.classes.dt$CE)
```

Checking the results:
```{r}
head(lipids.dt, n = 15)
```

Ooops, the function fails to classify lipids species containing the label "CE".
There are two possible reasons for this:

* the label "CE" and "Cer" tag Cholesterylester
* the label "CE" is the identifier of an ester not listed in `lipid.classed.dt`

A quick google search leads to the [LIPID MAPSÂ® Lipidomics Gateway website](https://www.lipidmaps.org/tools/ms/lm_mass_form.php)
which provides access to lipid nomenclature, databases, tools, protocols and many more to serve the international lipid research community.
Here, we learn that "CE" is the identifier for lipids belonging to the class Cholesterylester.
Hence, we add this label to `lipid.classes.dt`:
```{r}
lipid.classes.dt <- rbind(lipid.classes.dt, list("CE", "Cholesterylesters"))
```

Rerunning the classification function:
```{r}
classify.lipids(lipids.dt, "lipid.species" , lipid.classes.dt$CE)
```

Checking the results (again):
```{r}
head(lipids.dt, n = 15)
```

Merging the data tables and counting the number of lipids that fall in each class
```{r}
results.dt <- merge(lipids.dt, lipid.classes.dt, 
                    by.x = "lipid.class", 
                    by.y = "CE" )

table(results.dt$`Cholesterol esters`)
```

#### Problem 1 (b)

Computing the wald test statistic for each lipid species:
```{r}
lipids.dt[, "wald.test" := round((oddsratio-1)/se,3)]
```

Computing a p-value for each lipid species using the t distribution and append them to `results.dt`:
(Assuming that there were 288 patients in the dataset)
```{r}
lipids.dt[, "p.value(t-distn)" := signif(1-(pt(abs(wald.test), 277)-pt(-abs(wald.test), 277)),3)]
```

Computing a p-value for each lipid species using the normal distribution and append them to `results.dt`:
```{r}
lipids.dt[, "p.value(n-distn)" := signif(1-(pnorm(abs(wald.test))-pnorm(-abs(wald.test))),3)]
```

Providing some evidence to justify if the normal approximation is acceptable in this instance:
```{r}
hist(lipids.dt$wald.test, 
     breaks = 12,
     freq=F,
     main = "Distribution of Wald test statistic",
     xlab = "Wald test statistic",
     ylab = "Frequency")

lines(density(lipids.dt$wald.test), col="red")

lines(seq(-8, 8, by=.05), 
      dnorm(seq(-8, 8, by=.05), mean(lipids.dt$wald.test), sd(lipids.dt$wald.test)),
      col="blue")

legend("topright", c("observed density", "normal density"), col = c("red","blue"), lty = c(1,1))
```

Comparing the observed distribution with a normal distribution, it can be stated that the observed distribution deviates from the normal distn due to a higher leftwards-shifted peak and positive skewedness. However, the normal distribution is still acceptable as a rough approximation since we only care about the extreme values (tails or the distn) when computing a p-value and evaluating whether it is above or below a certain threshold (e.g. 0.05 or 0.01).

#### Problem (c)

#### Problem (d)

### Problem 1

### Problem 2

### Problem 3

### Problem 4